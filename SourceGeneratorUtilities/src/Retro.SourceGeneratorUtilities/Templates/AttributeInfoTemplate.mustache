using System;
using Retro.SourceGeneratorUtilities.Core.Attributes;
using Retro.SourceGeneratorUtilities.Core.Types;
#nullable enable

namespace {{Namespace}};

public record {{AttributeName}}Info{{#HasPrimaryConstructor}}({{#PrimaryConstructor.Parameters}}{{Type}} {{Name}}{{#HasDefaultValue}} = {{DefaultValue}}{{/HasDefaultValue}}{{^IsLast}}, {{/IsLast}}{{/PrimaryConstructor.Parameters}}){{/HasPrimaryConstructor}}{{#HasParentClass}} : {{ParentAttribute}}Info{{#HasPrimaryConstructor}}({{#PrimaryConstructor.HasInitializer}}{{#PrimaryConstructor.Initializer.Arguments}}{{Expression}}{{^IsLast}}, {{/IsLast}}{{/PrimaryConstructor.Initializer.Arguments}}{{/PrimaryConstructor.HasInitializer}}){{/HasPrimaryConstructor}}{{/HasParentClass}} {

  {{#Properties}}
  {{Accessibility}} {{Type}} {{Name}} { get;{{#HasSetter}} {{Setter.Type}};{{/HasSetter}} }{{#HasInitializer}} = {{Initializer}};{{/HasInitializer}}
  {{/Properties}}

  {{#Constructors}}
  public {{../AttributeName}}Info({{#Parameters}}{{Type}} {{Name}}{{#HasDefaultValue}} = {{DefaultValue}}{{/HasDefaultValue}}{{^IsLast}}, {{/IsLast}}{{/Parameters}}){{#HasInitializer}} : {{Initializer.Type}}({{#Initializer.Arguments}}{{Expression}}{{^IsLast}}, {{/IsLast}}{{/Initializer.Arguments}}){{/HasInitializer}} {
    {{#Assignments}}
    {{Left}} = {{Right}};
    {{/Assignments}}
  }
  
  {{/Constructors}}

}

public static class {{AttributeName}}InfoExtensions {

  public static {{AttributeName}}Info New(this AttributeInfo<{{AttributeName}}> info) {
    var args = info.Data.ConstructorArguments;

    {{#AllConstructors}}
    if (info.Data.HasMatchingConstructor({{#Parameters}}typeof({{NonNullableType}}){{^IsLast}}, {{/IsLast}}{{/Parameters}})) {
      {{#Parameters}}
      var arg{{Index}} = info.Data.ConstructorArguments[{{Index}}].GetTypedValue<{{Type}}>();
      {{/Parameters}}
      return new {{../AttributeName}}Info({{#Parameters}}arg{{Index}}{{^IsLast}}, {{/IsLast}}{{/Parameters}});   
    }
    
    {{/AllConstructors}}
    throw new InvalidOperationException("Cannot create {{AttributeName}}Info"); 
  }

}